2022年4月22日

```text
今日工作
1.ClickHouse官方文档阅读
2.熟悉数据库表及其结构

明日计划
1.后端代码阅读
2.ClickHouse官方文档阅读
```

待办

- [ ] 

```
<bind name="filters" value="global.filters"/>
        <bind name="relation" value="global.relationType"/>
        <bind name="appIndex" value="appIndex"/>
        <bind name="pageSize" value="pageSize"/>
        <bind name="pageIndex" value="pageIndex"/>
        <bind name="dimensions" value="dimensions"/>
```

```sql
select 'total', groupArray(
                 
         ` $lastCity
                
            
            ,
            
                
                    _$sum ` 

     
            ) as `groupArray`,
             
                  
                    sum(`_$sum`) as `_$sum`
                 
                 
                 
                 
                 
             
        from (
         
        select
        array(
         
             
         
              
                toString(`$lastCity`)
             
         
            ,
         
              
                toString(_$sum)
             
             
             
             
             
         
        ) as
         
         ` $lastCity
                
            
            ,
            
                
                    _$sum ` 

     
         
             
          
            toFloat64(sum(`$sessionCount`)) as `_$sum`
         
         
         
         
         
     
         
            from app_user b
         WHERE b.appIndex = 15 
         group by  appIndex,
            
                
            
                
                    $lastCity 

         order by  $lastCity 
        desc
     
        )
     
        UNION ALL
         
    select
     
          
            `$lastAppVersion`
         
     
         
     
     
        ,groupArray(
         
         ` $lastCity
                
            
            ,
            
                
                    _$sum ` 
     
        ) as groupArray
     
            ,
     
          
            sum(`_$sum`)
         
         
         
         
         
     
    from
     ( select
        
            
            
                
                    `$lastAppVersion`
                
            
                
            
                ,
                
            
                array(
                toString(`$lastCity`)
                        
                    
                    ,
                    
                        toString(
                        
        
            toFloat64(sum(`$sessionCount`)) as `_$sum`
        
        
        
        
        
    
                        )
                )
            
                    ,
        

        
        toFloat64(sum(`$sessionCount`)) as `_$sum`
    
        from app_user b
        WHERE b.appIndex = 15
        
            group by
            
        
            `$lastAppVersion`
        ,
            `$lastCity`
        
    
            order by
            
        
            `$lastAppVersion`
        ,
            `$lastCity`
        
    
            desc ) 
    group by
     
          
            $lastAppVersion
         
     
         
     
    order by
     
          
            $lastAppVersion
         
     
         
     
    desc
    limit 10 offset 0
```

